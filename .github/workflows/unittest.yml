name: Example action

on: [push]

jobs:
  build:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    steps:
    - uses: actions/checkout@v2
    - name: install k8s
      run: |
        curl -sfL https://get.k3s.io | K3S_KUBECONFIG_MODE=777 sh -
        cat /etc/rancher/k3s/k3s.yaml
        mkdir -p ~/.kube
        cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
    - name: example tests
      run: |
        kubectl cluster-info
        kubectl create deployment --image nginx my-nginx
        kubectl get pods
        kubectl get nodes
    - name: Set up Python
      uses: actions/setup-python@v1
      with:
        python-version: '3.6'
    - name: Install python requirements
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt
    - name: Netstat 1
      run: netstat | grep 9294
    - name: Docker status
      run: service docker status
    - name: Run unittests
      run: ./run_tests.sh
    - name: Netstat 1
      if: ${{ always() }}
      run: netstat
    - name: Print pod spec
      if: ${{ always() }}
      run: kubectl get pod -n default | grep my-input-task | awk '{print $1}' | xargs -I {} kubectl describe pod -n default {}